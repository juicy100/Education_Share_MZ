# ğŸ’ ìŠ¤í”„ë§ ë¶€íŠ¸ ê¸°ì´ˆ(êµìœ¡ 5íšŒì°¨_230421) {#top}
> created : 2023-04-21
> 
> updated : 2023-04-21
> 
> author : ë°±ë¯¼ì£¼
##
***
## ğŸ”¶ ëª©ì°¨
1. [ê°•ì˜ Background](#-ê°•ì˜-background)
2. [Mavenì—ì„œì˜ JPA ì‚¬ìš©](#-mavenì—ì„œì˜-jpa-ì‚¬ìš©)
    - [ì¡°íšŒ](#-ì¡°íšŒ) / [ìˆ˜ì •](#-ìˆ˜ì •) / [ì‚­ì œ](#-ì‚­ì œ)
3. [Springbootì—ì„œì˜ JPA ì‚¬ìš©](#-spring-bootì—ì„œì˜-jpa-ì‚¬ìš©)
***
## ğŸ”¶ ê°•ì˜ Background
- [ìˆ˜ì—…ë©”ëª¨](https://gist.github.com/carami/d3bb434cacf371d44e71538b93e6c212)
***
## ğŸ”¶ Mavenì—ì„œì˜ JPA ì‚¬ìš©
#### ğŸ”¹ ì¡°íšŒ
```java
// ì¡°íšŒ
   Product findProduct = em.find(Product.class, 1L);
   Product findProduct2 = em.find(Product.class, 1L);
   if (findProduct == findProduct2) System.out.println("ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì…ë‹ˆë‹¤."); //ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ì„
```
#### ğŸ”¹ ìˆ˜ì •
```java
// ìˆ˜ì •(ì¡°íšŒ í›„ ìˆ˜ì •)
   Product findProduct = em.find(Product.class, 1L);
   findProduct.setName("pen");
   findProduct.setPrice(5000);
```
#### ğŸ”¹ ì‚­ì œ
```java
// ì‚­ì œ(ì¡°íšŒ í›„ ì‚­ì œ)
   Product findProduct = em.find(Product.class, 1L);
   em.remove(findProduct);

   System.out.println("persist() ìˆ˜í–‰í›„!!");
   tx.commit(); //commitê¹Œì§€ í•´ì•¼ DBì— ë°˜ì˜ ì™„ë£Œ
   System.out.println("commit  ìˆ˜í–‰ í›„!!");
```
***
## ğŸ”¶ Spring bootì—ì„œì˜ JPA ì‚¬ìš©
- í”„ë¡œì íŠ¸ ì„¤ì • ì‹œ ì¶”ê°€íŒŒì¼
  - Spring Boot DevTools, Lombok, Spring Web, Spring Data JPA, Thymeleaf, H2 Database
    - Spring Data JPA : Springì—ì„œ JPAë¥¼ ë” ì‰½ê²Œ ì“°ê²Œ í•´ì¤Œ
#### ğŸ”¹ Annotation í™œìš©í•˜ì—¬ Entity ë§Œë“¤ê¸°
```java
package com.example.todo.domain;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
import javax.persistence.Table;

import lombok.Getter;
import lombok.Setter;
import lombok.ToString;

@Entity
@Table(name = "todos")
@Getter
@Setter
@ToString
public class Todo {

    @Id
    @GeneratedValue
    private Long id;
    @Column(name="todo_sample", unique=true, length=50)
    private String todo;
    private boolean done;
}
```
#### ğŸ”¹ í™˜ê²½ ì„¤ì •
- **`application.properties`ëŠ” ì˜¤íƒ€ ì²´í¬ë¥¼ ëª»í•´ì„œ `application.yml`ìœ¼ë¡œ íŒŒì¼ëª… Rename í•„ìš”**
  - application.properties : springbootì—ì„œ ìµœì†Œí•œì˜ ì„¤ì •ì— ëŒ€í•œ ê°’ì„ ì•Œë ¤ì£¼ë©´ ì‹¤í–‰ì„ ì•Œì•„ì„œ í•´ì£¼ëŠ” íŒŒì¼
- Datasource : JDBC ì„¤ì •
- JPA : DB ì„¤ì •(ìˆ˜ì—…ì—ì„œëŠ” hibernateë¡œ ì„¤ì •)
#### ğŸ”¹ Spring Data JPA ì“°ëŠ” ë°©ë²•
```java
package com.example.todo.repository;

import org.springframework.data.jpa.repository.JpaRepository;

import com.example.todo.domain.Product;

public interface ProductRepository extends JpaRepository<Product, Long> { 
    //JpaRepositoryë¼ëŠ” interfaceì—ê²Œ 1) ì–´ë–¤ Entityë¥¼ ì‚¬ìš©í•  ê±´ì§€
    //2) ê·¸ Entityì˜ keyì˜ typeì´ ë­”ì§€ë§Œ ì•Œë ¤ì£¼ë©´ ë‚˜ë¨¸ì§€ëŠ” ì•Œì•„ì„œ ë‹¤ êµ¬í˜„í•´ì¤Œ
}
```
#### ğŸ”¹ JPA í…ŒìŠ¤íŠ¸í•´ë³´ê¸°
- **src/test/javaì—ì„œ í•´ì•¼í•¨**
- ë©”ì†Œë“œ ë‹¨ìœ„ë¡œ í•´ì•¼í•˜ë‹ˆê¹Œ ì£¼ì„ì²˜ë¦¬ ì—†ì´ ê°„í¸í•˜ê²Œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥
  ```java
  package com.example.todo.repository;

  import java.util.Optional;

  import org.junit.jupiter.api.Test;
  import org.springframework.beans.factory.annotation.Autowired;
  import org.springframework.boot.test.context.SpringBootTest;

  import com.example.todo.domain.Product;

  @SpringBootTest
  public class ProductRepositoryTest {

    @Autowired
    ProductRepository productRepository;

    @Test // Tableì— Add Test
    void addProduct() throws Exception {
        Product p = new Product();
        p.setName("ì»¤í”¼");
        p.setPrice(5000);
        try {
            productRepository.save(p); // Repositoryì— saveë¥¼ í•´ì¤Œ
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Test // Addí•œ Entity ê°–ê³ ì˜¤ê¸°
    void getProduct() {
        Optional<Product> findProduct = productRepository.findById(34L);
        System.out.println(findProduct);
    }
  }
  ```
***
[ë§¨ ìœ„ë¡œ ê°€ê¸°](#top)
