# 💎 이노룰스 교육 정리 {#top}
> created : 2023-09-05
> 
> updated : 2023-09-08
> 
> author : 백민주
##
***
## 🔶 목차
1. [환경설정](#-환경설정)
2. [기본요소](#-기본요소)
3. [문법](#-문법)
4. [연산자](#-연산자)
5. [함수](#-함수)
6. [룰 템플릿](#-룰-템플릿)
  - [디시전 테이블 룰](#2-디시전-테이블-룰)
  - [DB 룰](#3-DB-룰)
  - [브랜치 룰](#4-브랜치-룰)
  - [루프 룰](#5-루프-룰)
  - [데이터 룰](#6-데이터-룰)
  - [콜백 룰](#7-콜백-룰)
  - [플로우 룰](#8-플로우-룰)
7. [추가기능](#-추가기능)
8. [룰 테스트](#-룰-테스트)
9. [Question](#-Question)
***
## 🔶 환경설정
#### 1. [설치페이지](http://iegw.innorules.com:31262/demo/index.jsp)
  - 다운로드
  - 세션ID 입력 (23/10/4까지 세션ID 사용가능)
#### 2. 빌더 보는 방식(IRBuilder.exe)
  - 보기/폴더 > 버전과 리턴 조회
  - 보기/폴더 > 폴더 - 룰 수평 배치
##
[맨 위로 가기](#top)
***
## 🔶 기본요소
#### 1. 최상위 폴더 만들기
  - 보기/폴더 > 최상위 폴더 추가 > 폴더 이름 작성 > 확인
#### 2. 하위 폴더 만들기(트리구조 만들기)
  - 최상위 폴더의 우측 마우스 클릭 > 폴더 추가 > 폴더 이름 작성 > 확인
#### 3. 항목 추가
  - 룰 작성/테스트 > 항목 > 추가
  - 항목이름(빌더에서 사용되는 이름) 작성
  - 항목별칭(영어, 프로그램에서 사용되는 이름) 작성
  - 데이터 타입
  - 항목설명(주석)
#### 4. 룰 추가
  - 하위폴더 > 룰 추가
  - 룰이름(빌더에서 사용되는 이름), 룰별칭(영어, 프로그램에서 사용되는 이름), 룰설명(주석) 작성
  - 리턴형식(Row가 하나이면 단일값/다중값) 선택 : 배열 쓸거면 다중값으로 출력, 단일값은 아무것도 없으면 에러지만 다중값은 에러 아님
  - 룰구분(서브룰/메인룰) 선택
  - 리턴항목이름/데이터타입 선택
#### 5. 룰 작성
  - 룰 저장(Ctrl+S)
  - 룰 테스트
  - 룰 실행경로 > 룰 열기
  - **모든 만족 조건 실행(조건이 없는 경우에도 실행되게 + 전 조건 모두 실행될 수 있게)**
  - 배열일 시, 망치 아이콘 > 배열 개수 제한 해제
#### 6. **버전 일자**
  - 룰 좌측 마우스 클릭 > 버전 추가
  - Rule Date에 따라 실행되는 결과가 달라짐
#### 7. 프로그램 상 룰 호출 코드 확인
  - 룰 테스트 > 룰 호출 코드 생성
##
[맨 위로 가기](#top)
***
## 🔶 문법
#### 1. 데이터 문자형에 숫자형 항목을 출력하려면 : `[급여금액] + ""` 혹은 `[급여금액].Array + ""`
#### 2. 테스트 > 망치 아이콘 > 참조했던 사용값 이용
#### 3. 오른쪽 하단 마우스 클릭 > 항목 관리 > 배열값 조정 가능
#### 4. 룰 이름은 유니크
#### 5. "" 일괄 붙이기 : 영역선택 > 문자열 변환 > 이중 인용부호 앞/뒤에 붙이기
#### 6. 룰 자체를 가져오는 방법 : `{인사평가}`
#### 7. 룰 자체를 정렬해서 가져오는 방법
  - 방식 1. `{인사평가::평가등급}` `{인사평가::평가점수}` `{인사평가::평가항목}`
  - 방식 2. `{인사평가::평가등급,평가점수,평가항목}`
#### 8. 룰 자체의 참조값을 바꿔서 호출하는 방법
  - 방식 1. `{인사평가등급:[평가점수]=92}`
  - 방식 2. `{인사평가등급::등급:[평가점수]=83}`
#### 9. 문자형을 숫자형으로 바꾸는 방법 : `ToNumber([사원번호]) + 10 + ""`
#### 10. 테스트 데이터 항목 순서 바꾸기 : 행 교환
#### 11. **문법 자동완성 : `Ctrl + Space`**
#### 12. 값 중에 만족되는게 있는지 확인하는 방법 
  - `[사원번호] = ("100101", "100102", "100103")`
  - `[급여항목].array = "야근수당"` : array 중에 만족하는 게 있으면 True, 없으면 False
#### 13. 참조값 : 항목관리 > 항목 > 참조값 클릭하여 관리
<img width="847" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/fbc26e08-e553-451f-8267-d8347d39e84b">

#### 14. 열채우기 : 데이터부 오른쪽 마우스 클릭, 자동으로 열 채우기 가능 
##
[맨 위로 가기](#top)
***
## 🔶 연산자
#### 1. 숫자 + 숫자 = 산술
#### 2. 문자 + 숫자 = 문자열
#### 3. 다중 + 단일 = 다중 (ex. `[급여금액].array + "원"`)
#### 4. 다중 + 다중 = 다중
  - **같은 위치(순서)에 있는 데이터끼리 연산이 됨, 그래서 각 항목의 길이가 동일 해야함** → `[사원번호].array + [급여항목].array`에서 사원번호, 급여항목 길이가 동일 해야함
#### 5. 크기 비교는 단일과 단일만 가능
##
[맨 위로 가기](#top)
***
## 🔶 함수
#### 1. Filter / MFilter
  - Filter : 1건만 필터로 조회(but 0일때 에러가 나지 않음) `"Filter( {평가결과::평가항목,평가점수}, {평가결과::평가등급}, ""B"")"`
  - MFilter : 다중건 조회  `"MFilter( {평가결과::평가항목,평가점수}, {평가결과::평가등급,평가점수}, ""B""|85)"`
#### 2. Sum
  - `"Sum( {평가결과::평가등급}, {평가결과::평가점수})"` : 평가등급을 key로 해서 평가점수를 sum하겠다는 의미임
  - `Sum( [급여금액].array )` : 급여금액들 전부다 sum
#### 3. Sort
  - `Sort({평가결과}, "2A, 3D")` : 평가결과 룰에서 **2번째 항목(평가등급)을 기준으로 오름차순, 3번째 항목(평가점수)를 기준으로 내림차순**
  - `Sort({평가결과::평가항목, 평가등급}, "1A")` : 평가항목을 기준으로 오름차순
  - 결과로 나오는 뷰를 통해 오름차순 or 내림차순 한다고 보면 됨
#### 4. Min/Max
  - `Min(Sum({상품 A 가산이율}), 1.2)` : 둘중에 작은 값으로
#### 5. StepVal
  - `stepVal(1, 9, 1)` : 1부터 9까지 1씩 증가시킬거야
##
[맨 위로 가기](#top)
***
## 🔶 룰 템플릿
#### 1. 성능을 고려해서 작성 필요
  - **가벼운 조건을 먼저 수행하도록 작성**
  - 동일항목은 동일열에 두기 (**동일조건은 셀병합도 가능**)
  - 추적할 때 **룰단위로 실행경로가 나오기 때문에**, 룰 단위로 룰을 짜는게 좋음
#### 2. 디시전 테이블 룰
  - 조건의 실행방식이 다름
  - 실행판단식 : **반드시 논리형으로 작성해야함** `Left([상품코드], 1) = "P"`
    - 실행판단식이 true가 아니면 해당 조건부 패스하고 다른 조건부로만 실행한다
  - 조건부 : 조건변경 버튼 클릭 → 이름/데이터타입 작성, 범위선택(열이 두개 생길 수 있음)
    - 조건 추가 : 열 왼족 마우스 클릭 → 조건 관리 → 조건 추가
    - 비교대상이 한개씩만 가능, 같은 값만 찾는게 가능
    - ""을 붙이지 않아도 됨(붙이면 붙이지 않은 것과 다른 값) → 상수이기 때문
    - 비교값 미지정 허용 : 빈칸에 대해 모두 다 허용해주겠다는 것
    - **조건부의 비교값 영역은 상수만 사용할 수 있음**
    - **만약 상수 말고 값을 가져와서 쓰려면, 조건식 부분에다 쓰고, 비교값 영역은 논리값으로 설정하면 됨**
  - 결과부 : 리턴 선택 관리 → 리턴 추가
    - **리턴 선택(조건)을 하기 위해서는 조건이 `리턴 구성 시 사용`이 체크되어 있어야함**
  - 디폴트 값은 맨 하단의 `자동부여` 버튼 옆에 작성하면 됨
  - `비교값 지정 조건만` : 모든 만족 조건 실행(위아래 조건 우선순위 고려 X)이 체크되어야만 체크할 수 있음 → **가장 많이 일치시키고 있는 경우의 수를 리턴**
    - **좌측부터 발췌**돼고 있기 때문에, 다른 조건부들의 순으로 만족시키고 있으면, 맨 좌측에 있는 데이터를 리턴
  - 🔹 꼭 필요한 경우가 아니면, `비교값 미지정 허용`을 자제한다
  - 🔹 전체 행의 수는 약 3천 라인을 넘지 않는다
  - 🔹 데이터 관리를 위한 용도의 룰로, **데이터 양이 많을 경우 데이터 룰로의 전환을 고려한다**
#### 3. DB 룰
  - SQL 작성법
    ```sql
    SELECT  PROD_CD, TERM, PRINCIPAL -- 상품코드, 기간, 금액
    FROM CUST_PROD     <$@ 고객 DB @$>
    WHERE CUST_ID IN (<$$[고객ID]$$>, '<$[고객ID]+"01"$>')
    ```
  - 추적 > 디비룰 > 오른쪽 마우스 클릭 > `SQL 보기` > 원본 SQL / 변환 SQL(실제로 전달되는 내용)
  - **변환 SQL로 전달하는 것**
    - `<$@ 룰 빌더 전용 주석 @$>` : 전달하지 않음
    - `<$$ 바인딩, 룰 문법 모두 허용 $$>` : 바인딩 처리(내부 조건 전달 방법)를 통해 인수 전달, **성능 고려한다면 바인딩 처리로 해야함**, **자주 사용되는 쿼리는 바인딩처리로!**
      - 바인딩 처리는 변환 SQL로 보면 `?`로 나옴
    - `<$ 하드코딩, 룰 문법 모두 허용 $>` : 하드코딩 방식을 통해 인수 전달
    - `'<$ 하드코딩, 룰 문법 모두 허용 $>'` : 문자열을 하드코딩 방식을 통해 인수 전달(앞뒤로 '' 붙이기)
#### 4. 브랜치 룰
  - 룰 정보 > 부가정보 > **`브랜치 노드`** 선택하면 분기가 가능한 테이블 룰로 설정 됨
  - 브랜치 룰 > 분기조건에 입력하면 브랜치 노드 리스트가 나옴 ex. `상품 [상품코드] 이율` (n건 가능)
  - 브랜치 룰 작성할 때는 **명명규칙(분기조건)을 고려해야함**
  - `디폴트값 실행` : 브랜치 룰은 있으나 유효한 버전이 없을 경우에 체크해서 실행 or 다른 테이블 룰 자체를 지정 가능
#### 5. 루프 룰
  - 항목에 데이터 룰 자체를 줘서, 리턴항목에 계산하는 수식 룰 넣어서 처리
  - 항목의 길이가 동일해야 에러가 안남
  - 브레이크 조건 : 판단식의 결과가 true가 되거나 누적 결과 건수에 의해 중단 가능
  - 루프 반복에도 변하지 않는 값은 임시 항목으로 만들어서 처리해야함
    - BUT! 임시항목의 수는 최소화 시켜야함, 그래야 성능적으로 문제 없음
    - 배열 같은 경우에는 임시항목으로 받자
#### 6. 데이터 룰
  - 디시전 룰 : 빌더에 Key-in 되어있음 vs 데이터룰 : 데이터를 불러서 사용(**대량 데이터를 사용할 때 사용**)
  - 데이터 모델 만들기(실제 업무 테이블에 데이터 insert 가능한 방법)
    1) 테이블 추가 : 운영/자원/설정 > 데이터모델 > 테이블관리 > 테이블추가, 키 & 값 동일하게 입력(룰에서 사용하는 데이터가 KEYFIELD ~ END_USER까지임)
        - APPLY_FLAG : 이관(=이행 = 배포) 여부를 나타내는 열
    2) 데이터 모델 추가 : 운영/자원/설정 > 데이터모델 > 테이블 이름/데이터 모델 ID/데이터 모델 이 작성, 데이터 타입 추가, 키 선택
    3) 데이터 추가 : 운영/자원/설정 > 데이터모델 > 데이터관리 > 행 추가해서 데이터 Insert
  - 데이터 모델 테스트 : 룰 작성/테스트 > SQL 도구 > SQL문 작성해서 SELECT 되는지 확인 (쓰는거 권장 X)
  - 데이터룰 만들기
    1) 조건 변경
    2) 데이터 모델 선택/매핑
    3) 어떤 데이터가 있는지 조회하려면 `데이터 조회` 버튼 클릭
#### 7. 콜백 룰
  - 콜백 룰 : 프로그램(서비스)에 다녀올 수 있게 하는 룰
#### 8. 플로우 룰
  - 노드 색깔 변경 : 운영/자원/설정 > 사용자 환경 > 룰 편집 > 노드 색깔 변경
  - 노드 연결은 연결선으로 x 표시 되는 노드의 끝 부분을 이어줘야함
  - **`플로우룰로 변환`** : 테이블 룰을 플로우 룰로 변환 가능
  - `Select Node` : 한번에 노드 누르기
  - `다중 요소 수정` : Select Node로 한 거를 한번에 수정하기 
### 🔹 정리
  - if-then-else를 쓸거면 → **테이블 룰**
  - 분기처리를 할거면 → **디시전 테이블 룰, 브랜치 룰**
  - DB 조회를 할거면 → **DB룰**
  - 데이터 관리를 할거면 → **데이터 룰**
  - 반복처리를 할거면 → **루프룰**
  - 프로그램 모듈 호출할거면 → **콜백룰**
##
[맨 위로 가기](#top)
***
## 🔶 추가기능
#### 1. 룰 찾기 : 룰 이름 / 룰 종류 / 최종변경일 등의 조건으로 룰 찾기
  - 룰을 변경할 때 영향을 미치는 다른 룰을 찾을 때: 룰 이름 오른쪽 마우스 클릭 > **리턴 항목을 사용하는 상위룰 찾기**
#### 2. 룰 정보 찾기 : 누가 최종 수정했는지 찾기
  - 룰 오른쪽 마우스 클릭 > 룰-버전 정보 > 버전정보
#### 3. 룰 버전별 or 운영/개발기별 소스 차이 찾기 : 룰 작성/테스트 > SQL 지원도구 > 룰 비교
#### 4. 호출 로그 찾기 : 룰 작성/테스트 > 호출로그
  <img width="929" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/6c69bc73-8ddc-4d38-bd77-a2b40af509ba">

  - 호출 로그를 클릭해서 `룰 테스트`를 하면 테스트 케이스 그대로 다시 테스트 할 수 있음
  - 운영계, 개발계, 검증계까지 보통 로그를 쌓고 있음
##
[맨 위로 가기](#top)
***
## 🔶 룰 테스트

#### 테스트 주의사항
  - 룰 실행 기준일자 입력 필요 
  - 테스트 데이터는 전사 공유하기 때문에 다른 사람들도 다 보는 거임
  - 엔진타임(=룰 실행시간) 확인 필요 → 지나치게 느려지면 점검 필요
  - `항목찾기`, `리턴 항목 찾기`를 통해 테스트 데이터를 찾을 수 있음
  - 테스트 항목 우클릭 후 `참조값 존재 여부` 선택하면 참조값 있는거로 볼 수 있
  - 우측 하단 `테스트 결과 비교` 테스트 케이스 추가한 다음에 좌측 하단 `테스트 결과` 비교 가능
  - 추적 시 `룰 북마크 추가` : 북마크 된 위치를 바로 찾아갈 수 있음

### 🔹 테스트 화면
<img width="959" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/535a5dd0-aec0-43e9-8be7-d36caa7d15ac">

### 🔹 테스트 비교 화면
<img width="960" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/6298d1ea-958e-408b-815e-652b8bc424c1">

### 🔹 테스트 추적 화면
<img width="957" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/8f11fefd-506b-4a90-9620-dd82c2bf1ddd">

  - 실행시간은 하위노드 실행시간을 포함함

### 🔹 다중 테스트 (블랙박스 테스트)
<img width="935" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/2c04650e-767c-42ef-9f1a-bdbc89faa53a">

  - 다중 테스트 내역서에 `예상 결과`를 입력해서 예상 결과와 실제 테스트 결과가 맞는지 비교 가능
  - **무작위 테스트도 가능(구멍이 없는지 무작위 테스트, 블랙박스 테스트)** 
    
    <img width="671" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/7811cf6f-96b4-4619-971d-0fce7dd5e5f5">

### 🔹 스펙트럼 테스트 (성능 테스트)
#### 1. 스펙트럼 실행
<img width="797" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/700ed6ff-97fc-4c89-b7dd-81f91a0169eb">

  - 룰을 선택하고 `룰 작성/테스트 > 스펙트럼 실행` 클릭
  - 반드시 확인하고자 하는 스펙트럼의 테스트 케이스가 저장되어 있어야함
  - 실행횟수 조정(**성능 테스트 가능**)
  - `제출` 눌러야 실행

#### 2. 스펙트럼 결과 확인
<img width="932" alt="image" src="https://github.com/juicy100/Education_Share_MZ/assets/114303119/2129450d-fc0b-4a41-abdb-2b37464552ac">

  - `룰 작성/테스트 > 스펙트럼 결과` 클릭
  - 튜닝방법
    - **결과 캐시 사용**
    - 루프 룰은 반복 실행에 필요한 항목만 사용
    - DB 룰은 바인딩을 사용
***
## 🔶 Question
1. 전체 항목 어떻게 보는지? 항목 보는 갯수 늘려서 보면 됨
2. 서브룰/메인룰의 차이는? 서브룰 - 다른 룰에 호출되어 사용되는 룰
***
[맨 위로 가기](#top)
